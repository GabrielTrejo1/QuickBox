{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Listado de Pedidos</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="stylesheet" href="{% static 'css/pantalla_ruta.css' %}" />
  </head>

  <body>
    {% include "includes/navbar.html" %}
    <main>
      <div class="container p-4">
        <form id="filtro" method="get" action="{% url 'pedido_list' %}">
          <input type="text" name="txtbusqueda" />
          <button type="submit" class="btn-buscar">üîç</button>
        </form>
        <h2>Listado de Pedidos</h2>
        <form method="post" action="{% url 'crear_ruta' %}">
          {% csrf_token %}

          <div class="card">
            <div class="card-body" style="padding: 0.5rem">
              <table class="table table-striped table-hover">
                <thead class="thead-dark" style="line-height: 0.8rem">
                  <tr>
                    <th>Seleccionar</th>
                    <th>Direcci√≥n</th>
                    <th>CP</th>
                    <th>Fecha de Carga</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for pedido in pedidos %}
                  <tr>
                    <td class="text-center align-middle">
                      <input
                        type="checkbox"
                        class="form-check-input position-static"
                        id="pedido-{{ pedido.id_pedido }}"
                        name="pedido_ids"
                        value="{{ pedido.id_pedido }}" />
                    </td>

                    <td>{{ pedido.direccion }}</td>
                    <td>{{ pedido.codigo_postal }}</td>
                    <td>{{ pedido.fecha_carga }}</td>

                    {% if pedido.estado == "Pendiente" %}
                    <td style="color: rgb(221, 169, 0)">{{ pedido.estado }}</td>
                    {% elif pedido.estado == "Entregado" %}
                    <td style="color: rgb(76, 198, 0)">{{ pedido.estado }}</td>
                    {% else %}
                    <td>{{ pedido.estado }}</td>
                    {% endif %}

                    <td>
                      <a
                        href="{% url 'pedido_edit' pedido.id_pedido %}"
                        style="color: black; text-decoration: none"
                        >Editar</a
                      >
                      <a
                        href="{% url 'pedido_delete' pedido.id_pedido %}"
                        style="color: crimson; text-decoration: none"
                        >Eliminar</a
                      >
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center">No hay pedidos disponibles.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              <p>Pedidos seleccionados: <span id="contador">0</span></p>
              <a href="{% url 'pedido_create' %}" class="btn btn-primary" style="margin-top: 20px"
                >Agregar Pedido</a
              >
              <div class="ruta-container">
                <input
                  type="text"
                  name="nombre_ruta"
                  class="textbox"
                  placeholder="Nombre de la Ruta"
                  required
                  value="{{ nombre_ruta }}" />
                <button type="submit" class="btn btn-primary">Crear Ruta</button>
              </div>
            </div>
          </div>
          <hr />
          <h2>Pedidos Entregados</h2>

          <div class="card mt-3">
            <div class="card-body" style="padding: 0.5rem">
              <table class="table table-striped table-hover">
                <thead class="thead-light">
                  <tr>
                    <th>Direcci√≥n</th>
                    <th>CP</th>
                    <th>Fecha de Carga</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody>
                  {% for pedido in pedidos_entregados %}
                  <tr>
                    <td>{{ pedido.direccion }}</td>
                    <td>{{ pedido.codigo_postal }}</td>
                    <td>{{ pedido.fecha_carga }}</td>
                    <td style="color: rgb(76, 198, 0)">{{ pedido.estado }}</td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="4" class="text-center">No hay pedidos entregados.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </form>
      </div>
    </main>
    <script>
      /*Este script sirve para que el contador de pedidos seleccionados 
    sume 1 cada vez que se selecciona un checkbox*/
      document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll(".form-check-input");
        const contador = document.getElementById("contador");

        function actualizarContador() {
          const seleccionados = document.querySelectorAll(".form-check-input:checked").length;
          contador.textContent = seleccionados;
        }

        checkboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", actualizarContador);
        });
      });
    </script>
  </body>
</html>
